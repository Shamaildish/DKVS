#!/bin/bash

numOfServers=$1
numOfClients=$2
serverCapacity=$3

consisting_hash_size=$(($1 * $3))

## kill all previous processes
kill -9 $(pidof DKVS) 2> /dev/null

## run Load Balancer
xterm -hold -e "./DKVS 0 $consisting_hash_size" &
sleep 0.1

## run servers
init_port=3030

for ((srv=0; srv<$numOfServers; srv++))
do
	xterm -hold -e "./DKVS 1 $init_port $serverCapacity" &
	((init_port=init_port+1010))
	
	sleep 0.1
done

## run client
for ((client=0; client<$numOfClients; client++))
do
	xterm -hold -e "./DKVS 2" &
done

## run another server
xterm -hold -e "./DKVS 1 $init_port $serverCapacity" &
