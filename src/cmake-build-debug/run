#!/bin/bash

numOfServers=$1
numOfClients=$2
serverCapacity=$3

consisting_hash_size=$(($1 * $3))

## kill all previous processes
kill -9 $(pidof DKVS) 2> /dev/null

## run Load Balancer
gnome-terminal -e  "./DKVS 0 $consisting_hash_size"

## run servers
init_port=3030

for ((srv=0; srv<$numOfServers; srv++))
do
	serverName=$srv
	gnome-terminal -e "./DKVS 1 $init_port $serverCapacity" 2> "server_$(srv)_err"
	((init_port=init_port+1010))
	
	sleep 0.5
done

## run client
for ((client=0; client<$numOfClients; client++))
do
	gnome-terminal -e "./DKVS 2" 2> "client_$(client)_err"
done
