#!/bin/bash

numOfServers=$1
numOfClients=$2
serverCapacity=$3

consisting_hash_size=$(($1 * $3))

## kill all previous processes
kill -9 $(pidof DKVS) 2> /dev/null

## run Load Balancer
./DKVS 0 $consisting_hash_size > lb_out

## run servers
init_port=3030

for ((srv=0; srv<$numOfServers; srv++))
do
	serverName=$srv
	./DKVS 1 $init_port $serverCapacity & > "server_$srv_out"
	((init_port=init_port+1010))
	
	sleep 0.5
done

## run client
for ((client=0; client<$numOfClients; client++))
do
	./DKVS 2 > client_out
done
